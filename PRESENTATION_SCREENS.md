# Cashflow App - Screen Descriptions

## 1. Login Screen
The entry point of the application featuring secure authentication with FaceID/TouchID biometric support integrated through Expo's local authentication module. Users can sign up for a new account or sign in with email and password, with credentials securely managed through Supabase authentication backend. After successful authentication, the app automatically prompts users to enable biometric login for faster future access, storing credentials locally using AsyncStorage for persistence. The screen includes smooth fade-in and slide-up animations using React Native Animated API, along with comprehensive keyboard handling using KeyboardAvoidingView and ScrollView to prevent input fields from being covered. FaceID credentials are securely stored locally using device keychain (iOS) or Keystore (Android) and persist even after sign-out for convenience, allowing seamless re-authentication. The biometric authentication uses device-level security with `disableDeviceFallback: true`, ensuring only FaceID/TouchID can unlock the app without password fallback for enhanced security. Includes comprehensive error handling for failed authentication attempts, network errors, and gracefully falls back to manual login when biometrics are unavailable or disabled. The screen detects the execution environment and provides appropriate warnings if running in Expo Go, which has limitations with native biometric features, guiding users to use development builds for full functionality.

## 2. Home Screen
The main dashboard displaying an overview of the user's entire financial portfolio aggregated from all user portfolios. Shows total net worth (sum of all portfolio values plus cash), portfolio value (market value of all holdings), cash balance (total cash across portfolios), and total dividends received (lifetime dividend income) across all portfolios. Users can create new portfolios (individual or retirement accounts) directly from this screen through a modal interface with portfolio type selection and name input. Displays a list of all portfolios with their current values (calculated using stored average prices for performance), cash balances, and portfolio types with distinct visual indicators. Features pull-to-refresh functionality using RefreshControl component and optimized loading for instant display without external API calls - the profile endpoint skips price fetching and uses stored average prices for sub-second load times. Each portfolio card shows the portfolio type (individual or retirement) with distinct icons (briefcase for individual, shield for retirement) and allows quick navigation to detailed views via touch interaction. The screen automatically retries failed API calls with exponential backoff (1 second delays, max 2 retries) to handle network issues gracefully, ensuring users always see their data even with intermittent connectivity. Portfolio values are calculated server-side using batched database queries, eliminating N+1 query problems and ensuring fast response times even with many holdings. The screen uses React Native's ScrollView with proper keyboard handling and refresh control, providing a smooth native mobile experience with platform-specific optimizations.

## 3. Portfolio Screen
Detailed view of a specific portfolio showing all holdings with real-time stock prices fetched from Polygon.io API and market values calculated dynamically. Users can add new holdings by searching for stock symbols (with symbol validation), entering share quantities, and seeing real-time cost calculations based on current prices fetched via debounced API calls and available cash balance. Selling functionality includes live calculations showing proceeds (shares × current price), remaining shares after sale, and validation to prevent selling more shares than owned. Displays portfolio performance metrics including total value (sum of all holding market values), cash balance (available for purchases), and individual holding details (symbol, shares, average price, current price, market value). Real-time price fetching ensures accurate buy/sell calculations with visual feedback - green checkmarks for sufficient funds/shares, red warnings with exact shortfall amounts for insufficient resources. The buy modal fetches current stock prices as users type the symbol, debounced to 500ms to minimize API calls, and calculates total cost dynamically (price × shares) with live updates as the user types. When selling, the app validates that users have enough shares (prevents negative share balances) and shows exactly how many shares will remain after the transaction, preventing overselling and ensuring data integrity. Price fetching uses parallel API calls with timeout protection (2 second max) and falls back to stored average prices if real-time fetch fails, ensuring the app remains functional even with API issues. The screen displays holdings in a scrollable list with visual separation, showing gain/loss indicators and providing quick access to sell functionality for each holding. All transactions update the portfolio's cash balance immediately, with buy transactions deducting cash and sell transactions adding proceeds, maintaining real-time financial accuracy.

## 4. Risk Analysis Screen
Comprehensive risk assessment tool that analyzes portfolio risk using multiple financial metrics calculated from historical price data and portfolio composition. Calculates overall risk score (0-100 scale, where higher scores indicate lower risk) based on weighted factors including volatility, concentration, dividend sustainability, and earnings stability. Provides two analysis modes: Quick Overview for fast insights using basic metrics (volatility, beta, Sharpe ratio) and Comprehensive for detailed risk breakdown including VaR, max drawdown, concentration analysis, dividend risk, and earnings risk. Identifies concentration risk by showing top holdings and their portfolio weights, highlighting when a single holding exceeds 30% or 50% of portfolio value (moderate and high concentration thresholds). Color-coded risk levels (Low/Moderate/High/Very High) help users quickly understand their portfolio's risk profile, with corresponding color schemes (green for low risk, yellow for moderate, red for high). The comprehensive analysis includes dividend sustainability risk (analyzing dividend payment history, volatility, and growth trends), earnings risk (evaluating earnings surprise history, revenue growth, profitability trends, and guidance reliability), and concentration analysis to provide a holistic view of portfolio health. Risk scores are calculated using weighted factors: volatility contributes -20 points for high volatility (>3%), concentration contributes -15 points for high concentration (>50% in single holding), dividend sustainability adjusts score based on payment reliability, and earnings risk contributes up to -15 points based on earnings stability. The screen displays metrics in a grid layout with icons and color coding, making complex financial data easily digestible. Value at Risk (VaR) shows the maximum potential loss at 95% confidence level, helping users understand downside risk. Maximum drawdown displays the largest peak-to-trough decline, indicating worst-case historical performance. The Sharpe ratio indicates risk-adjusted returns, helping users compare portfolio efficiency. Beta shows correlation with market movements, indicating how much the portfolio moves relative to the overall market.

## 5. Forecast Screen
Forward-looking projection tool that predicts future portfolio income based on dividend payments, historical dividend data, and user-selected growth scenarios. Users can select forecast duration (3, 6, 12, 24, or 36 months), growth scenarios (conservative at 2-3%, moderate at 5-7%, optimistic at 10-12%, pessimistic at -2% to 0%), and whether to reinvest dividends (automatically purchasing more shares with dividend income). Shows monthly income projections with visual indicators (icons and color coding) for months with dividend payments, displaying both dividend income and total portfolio value growth over time. Displays scenario comparisons side-by-side showing projected values under conservative, moderate, optimistic, and pessimistic market conditions, helping users understand the range of possible outcomes. Enables users to add recurring deposits (monthly contributions) to see how regular investments affect future income and portfolio growth, with calculations showing cumulative effects of deposits plus dividend reinvestment. The forecast engine simulates dividend payments based on historical dividend data from the database (ex-dates, payment dates, amounts) and applies growth rates to project future income streams, accounting for dividend payment schedules and frequency. Users can compare multiple scenarios side-by-side to understand the range of possible outcomes, helping them make informed decisions about their investment strategy and retirement planning. The forecast accounts for dividend reinvestment by calculating additional shares purchased with dividend income, which then generate their own dividends in subsequent periods, creating compound growth effects. The screen displays results in a scrollable list format showing each month's projected income, whether dividends are expected that month, and cumulative totals. Visual indicators highlight months with significant dividend payments, making it easy to identify high-income periods. The forecast uses Monte Carlo-like simulation techniques, applying growth rates to both stock prices and dividend amounts, providing realistic projections based on historical patterns and user-defined scenarios.

## 6. Dividends Screen
Calendar view displaying all upcoming dividend payments across all portfolios in a chronological format, aggregated from dividend events stored in the database. Shows dividend ex-dates (when shares must be owned to receive payment), payment dates (when cash is received), amounts per share (dividend rate), and total income for each holding (calculated as shares owned × dividend amount). Organized by month for easy planning and cash flow management, with each month showing all dividend events in chronological order, making it simple to see when income will be received. Highlights which stocks are paying dividends and when payments will be received, with visual indicators showing payment amounts and helping users plan for cash inflows. Helps users track passive income streams and plan for future cash inflows, enabling better budgeting and financial planning based on expected dividend income. The calendar aggregates dividend data from all portfolios, showing total monthly dividend income (sum of all payments in that month) and individual stock payments, giving users both macro and micro views of their income schedule. Each dividend event displays the symbol, ex-date, payment date, amount per share, and total payment based on shares owned, giving users a complete picture of their passive income schedule with all relevant details. The screen fetches dividend data from the backend's dividend events table, which is populated from external APIs (Polygon.io and yfinance) and kept up-to-date with current dividend schedules. Dividend amounts are displayed in both per-share and total formats, helping users understand both the dividend rate and their total income from each payment. The calendar view makes it easy to identify months with high dividend income (multiple stocks paying) versus months with lower or no dividend payments, helping with cash flow planning. Users can see at a glance which holdings are generating the most dividend income and when those payments occur, enabling strategic planning around dividend capture and reinvestment timing.

## 7. Profile Screen
User account management screen displaying personal information and comprehensive cash management tools for all portfolios. Shows total dividends received across all portfolios (lifetime cumulative dividend income), account summary information (user email, account creation date), and portfolio-level financial summaries. Allows users to add or withdraw cash from any portfolio with real-time balance updates, with transaction validation to prevent negative balances and ensure data integrity. Features secure sign-out functionality with confirmation prompts (Alert dialog) to prevent accidental logouts, and clears session data while preserving biometric credentials for future logins. Provides a centralized location for account settings and financial overview, displaying key metrics like total net worth, total portfolio value, and lifetime dividend income in an easy-to-read format. The cash management modal includes comprehensive validation to prevent negative balances (withdrawals cannot exceed available cash), invalid amounts (must be positive numbers), and shows updated balances immediately after transactions with visual confirmation. The screen displays a comprehensive financial summary including lifetime dividend income (tracked in user profile), helping users track their investment performance over time and see the cumulative effect of dividend investing. All cash operations are logged and reflected instantly across the app, ensuring data consistency and accurate portfolio tracking - when cash is added or withdrawn, the portfolio balance updates immediately and is visible on all screens. The screen uses a modal interface for cash management with portfolio selection dropdown, amount input with validation, and action buttons (add/withdraw) with loading states during API calls. Error handling ensures users receive clear feedback if transactions fail (insufficient funds, network errors, etc.) with actionable error messages. The profile data is fetched from the backend's user profile endpoint, which aggregates data from all portfolios and provides a unified view of the user's financial status. The screen includes pull-to-refresh functionality to manually update account information, ensuring users always have the latest data. Visual design uses cards and sections to organize information clearly, with distinct styling for different types of financial data (dividends, cash, portfolios) making it easy to scan and understand.

